<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üïµÔ∏è Imposter Online - 2K Gaming</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
            overflow-x: hidden;
            background: radial-gradient(ellipse at center, #1a1a2e 0%, #0f0f1a 50%, #050508 100%);
        }

        /* Animasyonlu Arka Plan */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .bg-animation::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background:
                radial-gradient(circle at 30% 20%, rgba(231, 76, 60, 0.15) 0%, transparent 25%),
                radial-gradient(circle at 70% 80%, rgba(46, 204, 113, 0.1) 0%, transparent 25%);
            animation: bgRotate 40s linear infinite;
        }

        @keyframes bgRotate {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .game-container {
            width: 100%;
            max-width: 550px;
            min-height: 100vh;
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Geri Butonu */
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .back-btn:hover {
            background: rgba(0, 0, 0, 0.7);
            transform: translateX(-5px);
        }

        /* Baƒülantƒ± Durumu */
        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 100;
        }

        .connection-status.connected {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
            border: 1px solid #2ecc71;
        }

        .connection-status.disconnected {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
            border: 1px solid #e74c3c;
        }

        /* Logo */
        .game-logo {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .game-title {
            font-size: 36px;
            font-weight: 900;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }

        .game-subtitle {
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            margin-bottom: 30px;
        }

        .online-badge {
            background: linear-gradient(135deg, #3498db, #2980b9);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        /* Ekranlar */
        .screen {
            display: none;
            width: 100%;
            flex-direction: column;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .screen.active {
            display: flex;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Kartlar */
        .card {
            background: linear-gradient(145deg, rgba(30, 30, 50, 0.9), rgba(20, 20, 35, 0.9));
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        }

        .card h2 {
            text-align: center;
            margin-bottom: 25px;
            font-size: 22px;
            color: #e74c3c;
        }

        /* Input */
        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            font-size: 13px;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 8px;
        }

        .input-group input {
            width: 100%;
            padding: 15px 18px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            color: #fff;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            border-color: #e74c3c;
            background: rgba(255, 255, 255, 0.12);
        }

        .input-group input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        /* Butonlar */
        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: #fff;
            box-shadow: 0 10px 30px rgba(231, 76, 60, 0.4);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(231, 76, 60, 0.5);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: #fff;
            box-shadow: 0 10px 30px rgba(52, 152, 219, 0.4);
        }

        .btn-secondary:hover:not(:disabled) {
            transform: translateY(-3px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .divider {
            display: flex;
            align-items: center;
            margin: 25px 0;
            color: rgba(255, 255, 255, 0.4);
        }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: rgba(255, 255, 255, 0.2);
        }

        .divider span {
            padding: 0 15px;
            font-size: 14px;
        }

        /* Oda Kodu */
        .room-code-display {
            background: rgba(231, 76, 60, 0.1);
            border: 2px dashed #e74c3c;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
        }

        .room-code-display p {
            color: rgba(255, 255, 255, 0.6);
            font-size: 13px;
            margin-bottom: 10px;
        }

        .room-code-display .code {
            font-size: 32px;
            font-weight: 900;
            color: #e74c3c;
            letter-spacing: 6px;
            font-family: 'Courier New', monospace;
        }

        .copy-btn {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid #e74c3c;
            color: #e74c3c;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            background: #e74c3c;
            color: #fff;
        }

        /* Oyuncu Listesi */
        .player-list {
            margin: 20px 0;
        }

        .player-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            margin-bottom: 10px;
        }

        .player-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 700;
            color: #fff;
            font-size: 16px;
        }

        .player-avatar.p1 {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .player-avatar.p2 {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        .player-avatar.p3 {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }

        .player-avatar.p4 {
            background: linear-gradient(135deg, #f1c40f, #d4ac0d);
        }

        .player-name {
            flex: 1;
            font-weight: 600;
        }

        .player-status {
            font-size: 12px;
            padding: 4px 12px;
            border-radius: 10px;
        }

        .status-host {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }

        .status-ready {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
        }

        .status-waiting {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
        }

        /* Bekleme */
        .waiting {
            text-align: center;
            padding: 30px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top-color: #e74c3c;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .waiting p {
            color: rgba(255, 255, 255, 0.6);
        }

        /* Rol Kartƒ± */
        .role-card {
            text-align: center;
            padding: 30px;
        }

        .role-type {
            font-size: 14px;
            font-weight: 600;
            padding: 8px 25px;
            border-radius: 30px;
            display: inline-block;
            margin-bottom: 25px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .role-type.innocent {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }

        .role-type.imposter {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .word-display {
            margin: 25px 0;
        }

        .word-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 10px;
        }

        .word-value {
            font-size: 36px;
            font-weight: 900;
            color: #ffd700;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.4);
        }

        .hint-value {
            font-size: 28px;
            font-weight: 700;
            color: #e74c3c;
        }

        .role-warning {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 20px;
            font-style: italic;
        }

        .hidden-content {
            filter: blur(15px);
            user-select: none;
            transition: filter 0.3s ease;
        }

        .reveal-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 30px;
            color: #fff;
            padding: 10px 25px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .reveal-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Tur Bilgisi */
        .round-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .round-number {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .round-title {
            font-size: 28px;
            font-weight: 900;
            margin-top: 5px;
        }

        /* ƒ∞pucu Giri≈üi */
        .clue-input-area {
            width: 100%;
        }

        .clue-input {
            width: 100%;
            padding: 18px;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 14px;
            color: #fff;
            font-size: 18px;
            text-align: center;
            outline: none;
            margin-bottom: 15px;
        }

        .clue-input:focus {
            border-color: #e74c3c;
        }

        .clue-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .clue-input:disabled {
            opacity: 0.5;
        }

        /* ƒ∞pucu Listesi */
        .clues-list {
            width: 100%;
            margin: 20px 0;
        }

        .clue-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            margin-bottom: 10px;
        }

        .clue-player {
            font-weight: 600;
            min-width: 80px;
        }

        .clue-text {
            flex: 1;
            color: rgba(255, 255, 255, 0.8);
            font-style: italic;
        }

        /* Oylama */
        .vote-options {
            width: 100%;
            margin: 20px 0;
        }

        .vote-btn {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 18px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
            width: 100%;
        }

        .vote-btn:hover {
            border-color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
        }

        .vote-btn.selected {
            border-color: #e74c3c;
            background: rgba(231, 76, 60, 0.2);
        }

        .vote-btn.voted {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Sonu√ß */
        .result-icon {
            font-size: 70px;
            margin-bottom: 20px;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .result-title {
            font-size: 28px;
            font-weight: 900;
            margin-bottom: 10px;
        }

        .result-title.win {
            color: #2ecc71;
        }

        .result-title.lose {
            color: #e74c3c;
        }

        .result-message {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 25px;
        }

        .result-reveal {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 14px;
            padding: 20px;
            text-align: center;
            margin: 10px 0;
            width: 100%;
        }

        .result-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 5px;
        }

        .result-value {
            font-size: 22px;
            font-weight: 700;
        }

        .vote-results {
            width: 100%;
            margin-top: 20px;
        }

        .vote-result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 8px;
        }

        .vote-count {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
            padding: 5px 12px;
            border-radius: 15px;
            font-weight: 700;
            font-size: 14px;
        }

        /* Hata */
        .error-msg {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid #e74c3c;
            color: #e74c3c;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            margin: 15px 0;
            font-size: 14px;
        }

        /* Responsive */
        @media (max-width: 480px) {
            .game-title {
                font-size: 28px;
            }

            .card {
                padding: 20px;
            }

            .room-code-display .code {
                font-size: 26px;
            }
        }
    </style>
</head>

<body>
    <div class="bg-animation"></div>
    <a href="index.html" class="back-btn">‚Üê Ana Men√º</a>
    <div id="connectionStatus" class="connection-status disconnected">Baƒülanƒ±yor...</div>

    <div class="game-container">
        <div class="game-logo">üïµÔ∏è</div>
        <h1 class="game-title">IMPOSTER</h1>
        <div class="online-badge">üåê ONLINE</div>
        <p class="game-subtitle">Kim yalan s√∂yl√ºyor?</p>

        <!-- MENU SCREEN -->
        <div id="menuScreen" class="screen active">
            <div class="card">
                <h2>üéÆ Oyuna Katƒ±l</h2>

                <div class="input-group">
                    <label>Oyuncu Adƒ±</label>
                    <input type="text" id="playerName" placeholder="ƒ∞sminizi girin" maxlength="12">
                </div>

                <button class="btn btn-primary" id="createRoomBtn">ODA OLU≈ûTUR (3-4 Ki≈üi)</button>

                <div class="divider"><span>veya</span></div>

                <div class="input-group">
                    <label>Oda Kodu</label>
                    <input type="text" id="roomCodeInput" placeholder="6 haneli kod" maxlength="6"
                        style="text-transform: uppercase; text-align: center; letter-spacing: 4px;">
                </div>

                <button class="btn btn-secondary" id="joinRoomBtn">ODAYA KATIL</button>

                <div id="menuError" class="error-msg" style="display: none;"></div>
            </div>
        </div>

        <!-- LOBBY SCREEN (Host) -->
        <div id="lobbyScreen" class="screen">
            <div class="card">
                <h2>üè† Oyun Lobisi</h2>

                <div class="room-code-display">
                    <p>Oda Kodunu Payla≈ü</p>
                    <div class="code" id="roomCodeDisplay">------</div>
                    <button class="copy-btn" id="copyCodeBtn">üìã Kopyala</button>
                </div>

                <div class="player-list" id="playerList">
                    <!-- Oyuncular buraya eklenecek -->
                </div>

                <p style="text-align: center; color: rgba(255,255,255,0.5); font-size: 13px; margin: 15px 0;">
                    Minimum 3, maksimum 4 oyuncu
                </p>

                <button class="btn btn-primary" id="startGameBtn" disabled>
                    OYUNU BA≈ûLAT
                </button>

                <div id="lobbyError" class="error-msg" style="display: none;"></div>
            </div>
        </div>

        <!-- WAITING SCREEN (Guest) -->
        <div id="waitingScreen" class="screen">
            <div class="card">
                <div class="waiting">
                    <div class="spinner"></div>
                    <p>Odaya katƒ±ldƒ±n!</p>
                    <p style="margin-top: 10px; font-weight: 600;">Host'un oyunu ba≈ülatmasƒ± bekleniyor...</p>
                </div>

                <div class="player-list" id="guestPlayerList">
                    <!-- Oyuncular buraya eklenecek -->
                </div>
            </div>
        </div>

        <!-- ROLE SCREEN -->
        <div id="roleScreen" class="screen">
            <div class="card">
                <div class="role-card">
                    <p style="color: rgba(255,255,255,0.5); margin-bottom: 10px;">Senin Rol√ºn</p>

                    <div id="roleContent" class="hidden-content">
                        <div class="role-type" id="roleType">MASUM</div>

                        <div class="word-display">
                            <div class="word-label" id="wordLabel">Kelime</div>
                            <div class="word-value" id="wordValue">???</div>
                        </div>
                    </div>

                    <button class="reveal-btn" id="revealBtn">üëÅÔ∏è G√∂rmek i√ßin tƒ±kla</button>

                    <p class="role-warning">Kimseye g√∂sterme! Hazƒ±r olduƒüunda devam et.</p>
                </div>

                <button class="btn btn-primary" id="roleReadyBtn">HAZIRIM ‚úì</button>
            </div>
        </div>

        <!-- CLUE SCREEN -->
        <div id="clueScreen" class="screen">
            <div class="card">
                <div class="round-header">
                    <div class="round-number">Tur <span id="roundNumber">1</span>/3</div>
                    <div class="round-title">ƒ∞pucu Yaz!</div>
                </div>

                <p style="text-align: center; color: rgba(255,255,255,0.6); margin-bottom: 20px; font-size: 14px;">
                    Kelimeyle ilgili bir ipucu yaz.<br>
                    <span style="color: #e74c3c;">Imposter'san: Tahmin et!</span>
                </p>

                <div class="clue-input-area">
                    <input type="text" class="clue-input" id="clueInput" placeholder="ƒ∞pucunu yaz..." maxlength="30">
                    <button class="btn btn-primary" id="submitClueBtn">G√ñNDER</button>
                </div>

                <div id="clueWaiting" class="waiting" style="display: none;">
                    <div class="spinner"></div>
                    <p>Diƒüer oyuncular yazƒ±yor...</p>
                    <div id="clueProgress" style="margin-top: 10px; font-weight: 600;"></div>
                </div>
            </div>
        </div>

        <!-- CLUES RESULT SCREEN -->
        <div id="cluesResultScreen" class="screen">
            <div class="card">
                <div class="round-header">
                    <div class="round-number">Tur <span id="cluesRoundNumber">1</span>/3</div>
                    <div class="round-title">ƒ∞pu√ßlarƒ±</div>
                </div>

                <div class="clues-list" id="cluesList">
                    <!-- ƒ∞pu√ßlarƒ± buraya -->
                </div>

                <button class="btn btn-primary" id="nextRoundBtn">
                    <span id="nextRoundBtnText">Sonraki Tur ‚Üí</span>
                </button>
            </div>
        </div>

        <!-- VOTE SCREEN -->
        <div id="voteScreen" class="screen">
            <div class="card">
                <div class="round-header">
                    <div class="round-number">Oylama</div>
                    <div class="round-title">Imposter Kim?</div>
                </div>

                <p style="text-align: center; color: rgba(255,255,255,0.6); margin-bottom: 20px; font-size: 14px;">
                    Sence hangi oyuncu Imposter?
                </p>

                <div class="vote-options" id="voteOptions">
                    <!-- Oy butonlarƒ± -->
                </div>

                <button class="btn btn-primary" id="submitVoteBtn" disabled>OYLA</button>

                <div id="voteWaiting" class="waiting" style="display: none;">
                    <div class="spinner"></div>
                    <p>Diƒüer oyuncular oyluyor...</p>
                </div>
            </div>
        </div>

        <!-- RESULT SCREEN -->
        <div id="resultScreen" class="screen">
            <div class="card" style="text-align: center;">
                <div class="result-icon" id="resultIcon">üéâ</div>
                <h2 class="result-title" id="resultTitle">MASUMLAR KAZANDI!</h2>
                <p class="result-message" id="resultMessage">Imposter yakalandƒ±!</p>

                <div class="result-reveal">
                    <div class="result-label">Imposter</div>
                    <div class="result-value" id="imposterReveal" style="color: #e74c3c;">???</div>
                </div>

                <div class="result-reveal">
                    <div class="result-label">Kelime</div>
                    <div class="result-value" id="wordReveal" style="color: #ffd700;">???</div>
                </div>

                <div class="vote-results" id="voteResults">
                    <!-- Oy sonu√ßlarƒ± -->
                </div>

                <button class="btn btn-primary" onclick="location.reload()" style="margin-top: 20px;">
                    üîÑ Yeni Oyun
                </button>
            </div>
        </div>
    </div>

    <script>
        // ========================
        // IMPOSTER ONLINE
        // PeerJS ile P2P Multiplayer
        // ========================

        // Kelime Havuzu
        const WORDS = [
            { word: "Pizza", hint: "Yiyecek" },
            { word: "K√∂pek", hint: "Hayvan" },
            { word: "Araba", hint: "Ula≈üƒ±m" },
            { word: "Telefon", hint: "Teknoloji" },
            { word: "Futbol", hint: "Spor" },
            { word: "Deniz", hint: "Doƒüa" },
            { word: "Kitap", hint: "Eƒülence" },
            { word: "G√ºne≈ü", hint: "G√∂ky√ºz√º" },
            { word: "M√ºzik", hint: "Sanat" },
            { word: "Kahve", hint: "ƒ∞√ßecek" },
            { word: "Bilgisayar", hint: "Teknoloji" },
            { word: "√áikolata", hint: "Tatlƒ±" },
            { word: "U√ßak", hint: "Ula≈üƒ±m" },
            { word: "Film", hint: "Eƒülence" },
            { word: "Gitar", hint: "M√ºzik aleti" },
            { word: "Ayakkabƒ±", hint: "Giyim" },
            { word: "Elma", hint: "Meyve" },
            { word: "Kedi", hint: "Hayvan" },
            { word: "Bisiklet", hint: "Ula≈üƒ±m" },
            { word: "Televizyon", hint: "Elektronik" },
            { word: "Burger", hint: "Yiyecek" },
            { word: "Basketbol", hint: "Spor" },
            { word: "Ku≈ü", hint: "Hayvan" },
            { word: "√ái√ßek", hint: "Bitki" },
            { word: "Tren", hint: "Ula≈üƒ±m" }
        ];

        // DOM Elements
        const menuScreen = document.getElementById('menuScreen');
        const lobbyScreen = document.getElementById('lobbyScreen');
        const waitingScreen = document.getElementById('waitingScreen');
        const roleScreen = document.getElementById('roleScreen');
        const clueScreen = document.getElementById('clueScreen');
        const cluesResultScreen = document.getElementById('cluesResultScreen');
        const voteScreen = document.getElementById('voteScreen');
        const resultScreen = document.getElementById('resultScreen');
        const connectionStatus = document.getElementById('connectionStatus');

        // State
        let peer = null;
        let connections = []; // Host: diƒüer oyunculara baƒülantƒ±lar
        let hostConnection = null; // Guest: host'a baƒülantƒ±
        let isHost = false;
        let myName = '';
        let myId = '';
        let roomCode = '';

        // Game State
        let players = []; // {id, name, isHost}
        let gameState = {
            word: null,
            imposterIndex: -1,
            currentRound: 1,
            clues: [[], [], []], // 3 tur i√ßin
            votes: {},
            readyPlayers: [],
            clueSubmitted: []
        };

        // Generate room code
        function generateRoomCode() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        // Show screen
        function showScreen(screen) {
            [menuScreen, lobbyScreen, waitingScreen, roleScreen, clueScreen, cluesResultScreen, voteScreen, resultScreen]
                .forEach(s => s.classList.remove('active'));
            screen.classList.add('active');
        }

        // Show error
        function showError(elementId, message) {
            const el = document.getElementById(elementId);
            el.textContent = message;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 4000);
        }

        // Update connection status
        function updateConnectionStatus(connected) {
            connectionStatus.className = 'connection-status ' + (connected ? 'connected' : 'disconnected');
            connectionStatus.textContent = connected ? 'üü¢ Baƒülƒ±' : 'üî¥ Baƒülantƒ± Yok';
        }

        // Initialize Peer
        function initPeer(id = null) {
            return new Promise((resolve, reject) => {
                peer = id ? new Peer(id) : new Peer();

                peer.on('open', (peerId) => {
                    console.log('Peer ID:', peerId);
                    myId = peerId;
                    updateConnectionStatus(true);
                    resolve(peerId);
                });

                peer.on('error', (err) => {
                    console.error('Peer error:', err);
                    if (err.type === 'unavailable-id') {
                        reject(new Error('Bu oda kodu kullanƒ±mda'));
                    } else if (err.type === 'peer-unavailable') {
                        reject(new Error('Oda bulunamadƒ±'));
                    } else {
                        reject(err);
                    }
                });

                peer.on('disconnected', () => updateConnectionStatus(false));
            });
        }

        // Render player list
        function renderPlayerList(containerId) {
            const container = document.getElementById(containerId);
            const avatars = ['p1', 'p2', 'p3', 'p4'];

            container.innerHTML = players.map((p, i) => `
                <div class="player-item">
                    <div class="player-avatar ${avatars[i]}">${i + 1}</div>
                    <span class="player-name">${p.name}</span>
                    <span class="player-status ${p.isHost ? 'status-host' : 'status-ready'}">
                        ${p.isHost ? 'Host' : 'Hazƒ±r'}
                    </span>
                </div>
            `).join('');
        }

        // Broadcast message to all connections (Host only)
        function broadcast(data) {
            connections.forEach(conn => {
                if (conn.open) conn.send(data);
            });
        }

        // Send message to host (Guest only)
        function sendToHost(data) {
            if (hostConnection && hostConnection.open) {
                hostConnection.send(data);
            }
        }

        // ========================
        // HOST FUNCTIONS
        // ========================

        async function createRoom() {
            const name = document.getElementById('playerName').value.trim();
            if (!name) {
                showError('menuError', 'L√ºtfen isminizi girin!');
                return;
            }

            myName = name;
            isHost = true;
            roomCode = generateRoomCode();

            try {
                await initPeer('IMPOSTER_' + roomCode);

                players = [{ id: myId, name: myName, isHost: true }];

                document.getElementById('roomCodeDisplay').textContent = roomCode;
                renderPlayerList('playerList');
                showScreen(lobbyScreen);

                // Listen for connections
                peer.on('connection', handleNewConnection);

            } catch (err) {
                showError('menuError', err.message);
            }
        }

        function handleNewConnection(conn) {
            if (players.length >= 4) {
                conn.on('open', () => {
                    conn.send({ type: 'error', message: 'Oda dolu!' });
                    setTimeout(() => conn.close(), 500);
                });
                return;
            }

            conn.on('open', () => {
                console.log('New player connected');
            });

            conn.on('data', (data) => {
                if (data.type === 'join') {
                    // Add player
                    const newPlayer = { id: conn.peer, name: data.name, isHost: false };
                    players.push(newPlayer);
                    connections.push(conn);

                    // Send current player list
                    broadcast({ type: 'players_update', players: players });
                    renderPlayerList('playerList');
                    updateStartButton();
                }

                if (data.type === 'role_ready') {
                    handleRoleReady(data.playerId);
                }

                if (data.type === 'clue_submit') {
                    handleClueSubmit(data.playerId, data.clue, data.round);
                }

                if (data.type === 'vote_submit') {
                    handleVoteSubmit(data.playerId, data.votedIndex);
                }

                if (data.type === 'next_round_ready') {
                    handleNextRoundReady(data.playerId);
                }
            });

            conn.on('close', () => {
                players = players.filter(p => p.id !== conn.peer);
                connections = connections.filter(c => c !== conn);
                broadcast({ type: 'players_update', players: players });
                renderPlayerList('playerList');
                updateStartButton();
            });
        }

        function updateStartButton() {
            const btn = document.getElementById('startGameBtn');
            btn.disabled = players.length < 3;
            btn.textContent = players.length < 3
                ? `OYUNU BA≈ûLAT (${players.length}/3 minimum)`
                : 'OYUNU BA≈ûLAT';
        }

        function startGame() {
            if (players.length < 3) return;

            // Select random word
            gameState.word = WORDS[Math.floor(Math.random() * WORDS.length)];

            // Select random imposter
            gameState.imposterIndex = Math.floor(Math.random() * players.length);

            // Reset state
            gameState.currentRound = 1;
            gameState.clues = [[], [], []];
            gameState.votes = {};
            gameState.readyPlayers = [];
            gameState.clueSubmitted = [];

            // Send game start to all
            broadcast({
                type: 'game_start',
                word: gameState.word,
                imposterIndex: gameState.imposterIndex,
                players: players
            });

            // Show role screen
            showRoleScreen();
        }

        function handleRoleReady(playerId) {
            if (!gameState.readyPlayers.includes(playerId)) {
                gameState.readyPlayers.push(playerId);
            }

            if (gameState.readyPlayers.length >= players.length) {
                // All ready, start clue round
                gameState.readyPlayers = [];
                broadcast({ type: 'start_clue_round', round: gameState.currentRound });
                showClueScreen();
            }
        }

        function handleClueSubmit(playerId, clue, round) {
            // Find player name
            const player = players.find(p => p.id === playerId);
            if (!player) return;

            // Add clue
            gameState.clues[round - 1].push({
                playerId: playerId,
                playerName: player.name,
                clue: clue
            });

            // Update progress
            const submitted = gameState.clues[round - 1].length;
            broadcast({ type: 'clue_progress', submitted: submitted, total: players.length });

            if (submitted >= players.length) {
                // All clues in, show results
                broadcast({
                    type: 'show_clues',
                    round: round,
                    clues: gameState.clues[round - 1]
                });
                showCluesResult();
            }
        }

        function handleNextRoundReady(playerId) {
            if (!gameState.readyPlayers.includes(playerId)) {
                gameState.readyPlayers.push(playerId);
            }

            if (gameState.readyPlayers.length >= players.length) {
                gameState.readyPlayers = [];

                if (gameState.currentRound >= 3) {
                    // Start voting
                    broadcast({ type: 'start_voting' });
                    showVoteScreen();
                } else {
                    gameState.currentRound++;
                    broadcast({ type: 'start_clue_round', round: gameState.currentRound });
                    showClueScreen();
                }
            }
        }

        function handleVoteSubmit(playerId, votedIndex) {
            gameState.votes[playerId] = votedIndex;

            if (Object.keys(gameState.votes).length >= players.length) {
                // Calculate results
                const voteCounts = {};
                Object.values(gameState.votes).forEach(v => {
                    voteCounts[v] = (voteCounts[v] || 0) + 1;
                });

                let maxVotes = 0;
                let mostVoted = -1;
                Object.entries(voteCounts).forEach(([idx, count]) => {
                    if (count > maxVotes) {
                        maxVotes = count;
                        mostVoted = parseInt(idx);
                    }
                });

                const imposterCaught = mostVoted === gameState.imposterIndex;

                broadcast({
                    type: 'game_result',
                    imposterCaught: imposterCaught,
                    imposterIndex: gameState.imposterIndex,
                    imposterName: players[gameState.imposterIndex].name,
                    word: gameState.word.word,
                    voteCounts: voteCounts
                });

                showResult(imposterCaught, voteCounts);
            }
        }

        // ========================
        // GUEST FUNCTIONS
        // ========================

        async function joinRoom() {
            const name = document.getElementById('playerName').value.trim();
            const code = document.getElementById('roomCodeInput').value.trim().toUpperCase();

            if (!name) {
                showError('menuError', 'L√ºtfen isminizi girin!');
                return;
            }

            if (!code || code.length !== 6) {
                showError('menuError', 'Ge√ßerli bir oda kodu girin!');
                return;
            }

            myName = name;
            isHost = false;
            roomCode = code;

            try {
                await initPeer();

                hostConnection = peer.connect('IMPOSTER_' + code);

                hostConnection.on('open', () => {
                    hostConnection.send({ type: 'join', name: myName });
                    showScreen(waitingScreen);
                });

                hostConnection.on('data', handleHostMessage);

                hostConnection.on('close', () => {
                    alert('Baƒülantƒ± koptu!');
                    location.reload();
                });

                hostConnection.on('error', (err) => {
                    showError('menuError', 'Baƒülantƒ± hatasƒ±: ' + err.message);
                });

            } catch (err) {
                showError('menuError', err.message);
            }
        }

        function handleHostMessage(data) {
            console.log('From host:', data);

            switch (data.type) {
                case 'error':
                    alert(data.message);
                    location.reload();
                    break;

                case 'players_update':
                    players = data.players;
                    renderPlayerList('guestPlayerList');
                    break;

                case 'game_start':
                    players = data.players;
                    gameState.word = data.word;
                    gameState.imposterIndex = data.imposterIndex;
                    gameState.currentRound = 1;
                    showRoleScreen();
                    break;

                case 'start_clue_round':
                    gameState.currentRound = data.round;
                    showClueScreen();
                    break;

                case 'clue_progress':
                    document.getElementById('clueProgress').textContent =
                        `${data.submitted}/${data.total} oyuncu yazdƒ±`;
                    break;

                case 'show_clues':
                    gameState.clues[data.round - 1] = data.clues;
                    showCluesResult();
                    break;

                case 'start_voting':
                    showVoteScreen();
                    break;

                case 'game_result':
                    showResult(data.imposterCaught, data.voteCounts, data);
                    break;
            }
        }

        // ========================
        // SHARED GAME SCREENS
        // ========================

        function showRoleScreen() {
            const myIndex = players.findIndex(p => p.id === myId);
            const isImposter = myIndex === gameState.imposterIndex;

            const roleType = document.getElementById('roleType');
            const wordLabel = document.getElementById('wordLabel');
            const wordValue = document.getElementById('wordValue');

            if (isImposter) {
                roleType.textContent = 'IMPOSTER';
                roleType.className = 'role-type imposter';
                wordLabel.textContent = 'ƒ∞pucu (Kategori)';
                wordValue.textContent = gameState.word.hint;
                wordValue.className = 'hint-value';
            } else {
                roleType.textContent = 'MASUM';
                roleType.className = 'role-type innocent';
                wordLabel.textContent = 'Kelime';
                wordValue.textContent = gameState.word.word;
                wordValue.className = 'word-value';
            }

            document.getElementById('roleContent').classList.add('hidden-content');
            showScreen(roleScreen);
        }

        function toggleReveal() {
            const content = document.getElementById('roleContent');
            const btn = document.getElementById('revealBtn');

            if (content.classList.contains('hidden-content')) {
                content.classList.remove('hidden-content');
                btn.textContent = 'üôà Gizle';
            } else {
                content.classList.add('hidden-content');
                btn.textContent = 'üëÅÔ∏è G√∂rmek i√ßin tƒ±kla';
            }
        }

        function roleReady() {
            if (isHost) {
                handleRoleReady(myId);
            } else {
                sendToHost({ type: 'role_ready', playerId: myId });
            }

            document.getElementById('roleReadyBtn').disabled = true;
            document.getElementById('roleReadyBtn').textContent = 'Bekleniyor...';
        }

        function showClueScreen() {
            document.getElementById('roundNumber').textContent = gameState.currentRound;
            document.getElementById('clueInput').value = '';
            document.getElementById('clueInput').disabled = false;
            document.getElementById('submitClueBtn').disabled = false;
            document.getElementById('clueWaiting').style.display = 'none';
            document.getElementById('clueProgress').textContent = '';
            showScreen(clueScreen);
        }

        function submitClue() {
            const clue = document.getElementById('clueInput').value.trim();
            if (!clue) return;

            document.getElementById('clueInput').disabled = true;
            document.getElementById('submitClueBtn').disabled = true;
            document.getElementById('clueWaiting').style.display = 'block';

            if (isHost) {
                handleClueSubmit(myId, clue, gameState.currentRound);
            } else {
                sendToHost({
                    type: 'clue_submit',
                    playerId: myId,
                    clue: clue,
                    round: gameState.currentRound
                });
            }
        }

        function showCluesResult() {
            document.getElementById('cluesRoundNumber').textContent = gameState.currentRound;

            const cluesList = document.getElementById('cluesList');
            const roundClues = gameState.clues[gameState.currentRound - 1];
            const avatars = ['p1', 'p2', 'p3', 'p4'];

            cluesList.innerHTML = roundClues.map((c, i) => `
                <div class="clue-item">
                    <div class="player-avatar ${avatars[i % 4]}" style="width:35px;height:35px;font-size:14px;">${i + 1}</div>
                    <span class="clue-player">${c.playerName}:</span>
                    <span class="clue-text">"${c.clue}"</span>
                </div>
            `).join('');

            const btnText = document.getElementById('nextRoundBtnText');
            btnText.textContent = gameState.currentRound >= 3 ? 'Oylamaya Ge√ß ‚Üí' : 'Sonraki Tur ‚Üí';

            document.getElementById('nextRoundBtn').disabled = false;
            showScreen(cluesResultScreen);
        }

        function nextRound() {
            document.getElementById('nextRoundBtn').disabled = true;

            if (isHost) {
                handleNextRoundReady(myId);
            } else {
                sendToHost({ type: 'next_round_ready', playerId: myId });
            }
        }

        function showVoteScreen() {
            const voteOptions = document.getElementById('voteOptions');
            const myIndex = players.findIndex(p => p.id === myId);
            const avatars = ['p1', 'p2', 'p3', 'p4'];

            voteOptions.innerHTML = players.map((p, i) => {
                if (i === myIndex) return ''; // Kendine oy veremez
                return `
                    <div class="vote-btn" data-index="${i}" onclick="selectVote(${i})">
                        <div class="player-avatar ${avatars[i]}" style="width:40px;height:40px;">${i + 1}</div>
                        <span class="player-name">${p.name}</span>
                    </div>
                `;
            }).join('');

            document.getElementById('submitVoteBtn').disabled = true;
            document.getElementById('voteWaiting').style.display = 'none';
            showScreen(voteScreen);
        }

        let selectedVoteIndex = -1;

        function selectVote(index) {
            selectedVoteIndex = index;

            document.querySelectorAll('.vote-btn').forEach(btn => {
                btn.classList.remove('selected');
                if (parseInt(btn.dataset.index) === index) {
                    btn.classList.add('selected');
                }
            });

            document.getElementById('submitVoteBtn').disabled = false;
        }

        function submitVote() {
            if (selectedVoteIndex === -1) return;

            document.querySelectorAll('.vote-btn').forEach(btn => btn.classList.add('voted'));
            document.getElementById('submitVoteBtn').disabled = true;
            document.getElementById('voteWaiting').style.display = 'block';

            if (isHost) {
                handleVoteSubmit(myId, selectedVoteIndex);
            } else {
                sendToHost({ type: 'vote_submit', playerId: myId, votedIndex: selectedVoteIndex });
            }
        }

        function showResult(imposterCaught, voteCounts, data = null) {
            const icon = document.getElementById('resultIcon');
            const title = document.getElementById('resultTitle');
            const message = document.getElementById('resultMessage');

            if (imposterCaught) {
                icon.textContent = 'üéâ';
                title.textContent = 'MASUMLAR KAZANDI!';
                title.className = 'result-title win';
                message.textContent = 'Imposter yakalandƒ±!';
            } else {
                icon.textContent = 'üòà';
                title.textContent = 'IMPOSTER KAZANDI!';
                title.className = 'result-title lose';
                message.textContent = 'Imposter ka√ßmayƒ± ba≈üardƒ±!';
            }

            // For guests, use data from host
            const imposterName = data ? data.imposterName : players[gameState.imposterIndex].name;
            const word = data ? data.word : gameState.word.word;

            document.getElementById('imposterReveal').textContent = imposterName;
            document.getElementById('wordReveal').textContent = word;

            // Vote results
            const voteResults = document.getElementById('voteResults');
            voteResults.innerHTML = '<div style="text-align:center;color:rgba(255,255,255,0.5);font-size:12px;margin-bottom:15px;">OY DAƒûILIMI</div>';

            const impIdx = data ? data.imposterIndex : gameState.imposterIndex;

            players.forEach((p, i) => {
                const count = voteCounts[i] || 0;
                const isImp = i === impIdx;
                voteResults.innerHTML += `
                    <div class="vote-result-item">
                        <span style="color: ${isImp ? '#e74c3c' : '#fff'}; font-weight: 600;">
                            ${p.name} ${isImp ? '(Imposter)' : ''}
                        </span>
                        <span class="vote-count">${count} oy</span>
                    </div>
                `;
            });

            showScreen(resultScreen);
        }

        // ========================
        // EVENT LISTENERS
        // ========================

        document.getElementById('createRoomBtn').addEventListener('click', createRoom);
        document.getElementById('joinRoomBtn').addEventListener('click', joinRoom);
        document.getElementById('startGameBtn').addEventListener('click', startGame);
        document.getElementById('revealBtn').addEventListener('click', toggleReveal);
        document.getElementById('roleReadyBtn').addEventListener('click', roleReady);
        document.getElementById('submitClueBtn').addEventListener('click', submitClue);
        document.getElementById('nextRoundBtn').addEventListener('click', nextRound);
        document.getElementById('submitVoteBtn').addEventListener('click', submitVote);

        document.getElementById('copyCodeBtn').addEventListener('click', () => {
            const code = document.getElementById('roomCodeDisplay').textContent;
            navigator.clipboard.writeText(code).then(() => {
                document.getElementById('copyCodeBtn').textContent = '‚úÖ Kopyalandƒ±!';
                setTimeout(() => {
                    document.getElementById('copyCodeBtn').textContent = 'üìã Kopyala';
                }, 2000);
            });
        });

        // Enter key for clue input
        document.getElementById('clueInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') submitClue();
        });

        // Room code uppercase
        document.getElementById('roomCodeInput').addEventListener('input', (e) => {
            e.target.value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
        });
    </script>
</body>

</html>
